{% extends 'base.html' %}
{% load static %}

{% block title %}MİZAÇLAR | {{ dominant_element }} Önerilerim{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profiles.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-settings-container">
        <!-- Header Section -->
        <div class="profile-header">
            <h1>{{ dominant_element }} Mizacınız İçin Öneriler</h1>
            <p class="element-description">Size özel olarak hazırlanmış, mizacınızın özelliklerine uygun içerikler</p>
        </div>

        <!-- KENDİ MİZACINA ÖZEL ÖNERİLER BÖLÜMÜ -->
        <div class="profile-card recommendations-container">
            <h2 class="recommendations-title">Sizin İçin Öneriler</h2>
            <p class="recommendations-subtitle">{{ dominant_element }} mizacınıza uygun kişiselleştirilmiş içerikler</p>

            <!-- Kendi Mizacı İçerikler Grid Container -->
            <div class="grid-container">
                <div class="grid-wrapper" id="myContentWrapper">
                    <div class="my-content-grid" id="myContentGrid">
                        {% for content in contents %}
                            <div class="content-card" data-content-id="{{ content.id }}" data-category="{{ content.category.id }}">
                                {% if content.image %}
                                <div class="content-image" style="background-image: url('{{ content.image.url }}')"></div>
                                {% else %}
                                <div class="content-image placeholder-image">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                {% endif %}
                                <div class="content-title">{{ content.title }}</div>
                                <div class="interaction-buttons">
                                    <button class="interaction-button like-button {% if content.is_liked %}liked{% endif %}" 
                                            data-content-id="{{ content.id }}">
                                        <i class="{% if content.is_liked %}fas{% else %}far{% endif %} fa-heart"></i>
                                        <span class="like-count">{{ content.like_count }}</span>
                                    </button>
                                    <button class="interaction-button save-button {% if content.is_saved %}saved{% endif %}" 
                                            data-content-id="{{ content.id }}">
                                        <i class="{% if content.is_saved %}fas{% else %}far{% endif %} fa-bookmark"></i>
                                        <span class="save-text">{% if content.is_saved %}Kaydedildi{% else %}Kaydet{% endif %}</span>
                                    </button>
                                </div>
                            </div>
                        {% empty %}
                            <div class="empty-content">
                                <p>{{ dominant_element }} mizacı için henüz öneri içeriği eklenmemiştir.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Kendi Mizacı Kaydırma Kontrolleri -->
            <div class="scroll-controls">
                <button class="scroll-button" id="prevMyContent" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="pagination-indicator" id="myContentPagination">
                    <!-- Pagination dots will be added dynamically -->
                </div>
                <button class="scroll-button" id="nextMyContent">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- BÖLÜM AYIRICI -->
        <div class="section-divider">
            <span class="section-divider-text">Tüm Mizaçlar İçin Öneriler</span>
        </div>

        <!-- TÜM MİZAÇLAR İÇİN ÖNERİLER BÖLÜMÜ -->
        <div class="profile-card recommendations-container">
            <h2 class="recommendations-title">Keşfedilecek İçerikler</h2>
            <p class="recommendations-subtitle">Farklı mizaç tipleri için önerilen içerikler</p>

            <!-- Element Sekmeleri -->
            <div class="element-tabs">
                <div class="element-tab active" data-element="all">Tümü</div>
                <div class="element-tab" data-element="Ateş">Ateş</div>
                <div class="element-tab" data-element="Hava">Hava</div>
                <div class="element-tab" data-element="Su">Su</div>
                <div class="element-tab" data-element="Toprak">Toprak</div>
            </div>

            <!-- Tüm Mizaçlar İçerikler Grid Container -->
            <div class="grid-container">
                <div class="grid-wrapper" id="allContentWrapper">
                    <div class="all-content-grid" id="allContentGrid">
                        <!-- Burada tüm mizaçlar için içerikler görüntülenecek -->
                        <!-- Bu kısım JavaScript ile dinamik olarak doldurulacak -->
                    </div>
                </div>
            </div>

            <!-- Tüm Mizaçlar Kaydırma Kontrolleri -->
            <div class="scroll-controls">
                <button class="scroll-button" id="prevAllContent" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="pagination-indicator" id="allContentPagination">
                    <!-- Pagination dots will be added dynamically -->
                </div>
                <button class="scroll-button" id="nextAllContent">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Content Detail Modal -->
<div class="content-modal" id="contentModal">
    <div class="modal-container">
        <div class="modal-header">
            <div class="modal-navigation">
                <button class="modal-nav-button" id="prevModalContent"><i class="fas fa-chevron-left"></i></button>
            </div>
            <div class="modal-content-area">
                <h2 id="modalTitle"></h2>
            </div>
            <div class="modal-close">
                <button class="modal-close-button" id="closeModal"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="modal-body">
            <div id="modalContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <div class="modal-interactions">
                <button class="modal-interaction-btn modal-like-btn" id="modalLikeBtn">
                    <i class="far fa-heart"></i> Beğen
                </button>
                <button class="modal-interaction-btn modal-save-btn" id="modalSaveBtn">
                    <i class="far fa-bookmark"></i> Kaydet
                </button>
            </div>
            <div class="modal-pagination" id="modalPagination">
                <!-- Modal sayfalama noktaları JS ile dinamik olarak oluşturulacak -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ---------- KENDİ MİZACI İÇİN ÖNERİLER ----------
    // Kendi mizacı içerik kartları
    const myContentCards = document.querySelectorAll('.my-content-grid .content-card');
    const myItemsPerPage = 3; // Her sayfada 3 içerik (yan yana 3x1 grid)
    
    // Kendi mizacı sayfalama değişkenleri
    let myCurrentPage = 0;
    let myTotalPages = Math.ceil(myContentCards.length / myItemsPerPage);
    
    // Pagination noktalarını oluştur - kendi mizacı için
    function createMyPaginationDots() {
        const paginationContainer = document.getElementById('myContentPagination');
        paginationContainer.innerHTML = '';
        
        for (let i = 0; i < myTotalPages; i++) {
            const dot = document.createElement('div');
            dot.classList.add('page-dot');
            if (i === 0) dot.classList.add('active');
            dot.dataset.page = i;
            
            dot.addEventListener('click', function() {
                showMyPage(parseInt(this.dataset.page));
            });
            
            paginationContainer.appendChild(dot);
        }
    }
    
    // Sayfa gösterme fonksiyonu - kendi mizacı için
    function showMyPage(pageNum) {
        if (pageNum < 0 || pageNum >= myTotalPages) return;
        
        const wrapper = document.getElementById('myContentWrapper');
        const grid = document.getElementById('myContentGrid');
        const gridWidth = grid.offsetWidth;
        
        wrapper.style.transform = `translateX(-${pageNum * gridWidth}px)`;
        
        // Aktif noktayı güncelle
        const dots = document.querySelectorAll('#myContentPagination .page-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === pageNum);
        });
        
        // Kaydırma butonlarını güncelle
        document.getElementById('prevMyContent').disabled = pageNum === 0;
        document.getElementById('nextMyContent').disabled = pageNum === myTotalPages - 1;
        
        myCurrentPage = pageNum;
    }
    
    // Kaydırma butonlarına olay ekle - kendi mizacı için
    document.getElementById('prevMyContent').addEventListener('click', function() {
        showMyPage(myCurrentPage - 1);
    });
    
    document.getElementById('nextMyContent').addEventListener('click', function() {
        showMyPage(myCurrentPage + 1);
    });
    
    // ---------- TÜM MİZAÇLAR İÇİN ÖNERİLER ----------
    // Bütün içerik verilerini al (bu veriyi AJAX ile almalısınız)
    let allContents = []; // Bu diziyi AJAX ile dolduracağız
    let filteredContents = []; // Aktif filtrelenen içerikler
    
    // Element filtreleri
    const elementTabs = document.querySelectorAll('.element-tab');
    let activeElement = 'all';
    
    // Tüm mizaçlar için sayfalama değişkenleri
    const allItemsPerPage = 6; // Her sayfada 6 içerik (3x2 grid)
    let allCurrentPage = 0;
    let allTotalPages = 0;
    
    // Element sekmelerine tıklama olayı ekle
    elementTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            // Aktif sekmeyi değiştir
            elementTabs.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            // Element filtresini uygula
            activeElement = this.dataset.element;
            filterContents();
        });
    });
    
    // İçerikleri filtrele
    function filterContents() {
        if (activeElement === 'all') {
            filteredContents = [...allContents];
        } else {
            filteredContents = allContents.filter(content => 
                content.related_element_name === activeElement
            );
        }
        
        // Sayfalama bilgilerini güncelle
        allTotalPages = Math.ceil(filteredContents.length / allItemsPerPage);
        allCurrentPage = 0;
        
        // İçerikleri göster ve sayfalama noktalarını oluştur
        renderAllContents();
        createAllPaginationDots();
    }
    
    // Tüm içerikleri göster
    function renderAllContents() {
        const grid = document.getElementById('allContentGrid');
        grid.innerHTML = '';
        
        if (filteredContents.length === 0) {
            const emptyMessage = document.createElement('div');
            emptyMessage.className = 'empty-content';
            emptyMessage.innerHTML = '<p>Bu element için henüz içerik eklenmemiştir.</p>';
            grid.appendChild(emptyMessage);
            return;
        }
        
        // İçerikleri grida ekle
        filteredContents.forEach(content => {
            const card = document.createElement('div');
            card.className = 'content-card';
            card.dataset.contentId = content.id;
            card.dataset.category = content.category_id;
            
            // Element rozetini göster
            const elementBadgeClass = getElementBadgeClass(content.related_element_name);
            
            card.innerHTML = `
                <div class="card-element-badge ${elementBadgeClass}">${content.related_element_name}</div>
                ${content.image ? 
                    `<div class="content-image" style="background-image: url('${content.image}')"></div>` : 
                    `<div class="content-image placeholder-image"><i class="fas fa-book-open"></i></div>`
                }
                <div class="content-title">${content.title}</div>
                <div class="interaction-buttons">
                    <button class="interaction-button like-button ${content.is_liked ? 'liked' : ''}" 
                            data-content-id="${content.id}">
                        <i class="${content.is_liked ? 'fas' : 'far'} fa-heart"></i>
                        <span class="like-count">${content.like_count || 0}</span>
                    </button>
                    <button class="interaction-button save-button ${content.is_saved ? 'saved' : ''}" 
                            data-content-id="${content.id}">
                        <i class="${content.is_saved ? 'fas' : 'far'} fa-bookmark"></i>
                        <span class="save-text">${content.is_saved ? 'Kaydedildi' : 'Kaydet'}</span>
                    </button>
                </div>
            `;
            
            // İçerik kartına tıklama olayı ekle
            card.addEventListener('click', function(e) {
                if (!e.target.closest('.interaction-button')) {
                    openContentModal(content.id);
                }
            });
            
            // Beğenme ve kaydetme butonlarına olay ekle
            const likeButton = card.querySelector('.like-button');
            likeButton.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleLike(content.id, this);
            });
            
            const saveButton = card.querySelector('.save-button');
            saveButton.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleSave(content.id, this);
            });
            
            grid.appendChild(card);
        });
        
        // İlk sayfayı göster
        showAllPage(0);
    }
    
    // Element sınıf adını al
    function getElementBadgeClass(elementName) {
        switch(elementName) {
            case 'Ateş': return 'element-badge-fire';
            case 'Hava': return 'element-badge-air';
            case 'Su': return 'element-badge-water';
            case 'Toprak': return 'element-badge-earth';
            default: return '';
        }
    }
    
    // Pagination noktalarını oluştur - tüm mizaçlar için
    function createAllPaginationDots() {
        const paginationContainer = document.getElementById('allContentPagination');
        paginationContainer.innerHTML = '';
        
        for (let i = 0; i < allTotalPages; i++) {
            const dot = document.createElement('div');
            dot.classList.add('page-dot');
            if (i === 0) dot.classList.add('active');
            dot.dataset.page = i;
            
            dot.addEventListener('click', function() {
                showAllPage(parseInt(this.dataset.page));
            });
            
            paginationContainer.appendChild(dot);
        }
    }
    
    // Sayfa gösterme fonksiyonu - tüm mizaçlar için
    function showAllPage(pageNum) {
        if (pageNum < 0 || pageNum >= allTotalPages) return;
        
        const wrapper = document.getElementById('allContentWrapper');
        const grid = document.getElementById('allContentGrid');
        const gridWidth = grid.offsetWidth;
        
        wrapper.style.transform = `translateX(-${pageNum * gridWidth}px)`;
        
        // Aktif noktayı güncelle
        const dots = document.querySelectorAll('#allContentPagination .page-dot');
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === pageNum);
        });
        
        // Kaydırma butonlarını güncelle
        document.getElementById('prevAllContent').disabled = pageNum === 0;
        document.getElementById('nextAllContent').disabled = pageNum === allTotalPages - 1;
        
        allCurrentPage = pageNum;
    }
    
    // Kaydırma butonlarına olay ekle - tüm mizaçlar için
    document.getElementById('prevAllContent').addEventListener('click', function() {
        showAllPage(allCurrentPage - 1);
    });
    
    document.getElementById('nextAllContent').addEventListener('click', function() {
        showAllPage(allCurrentPage + 1);
    });
    
    // ---------- ORTAK FONKSİYONLAR ----------
    // Beğenme işlevi
    function toggleLike(contentId, button) {
        fetch(`/profiles/content/${contentId}/toggle_like/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Tüm kartlarda ve modalda güncelleme yap
                updateLikeButtons(contentId, data.liked);
                
                // Beğeni sayısını güncelle
                const likeCountElements = document.querySelectorAll(`.like-button[data-content-id="${contentId}"] .like-count`);
                likeCountElements.forEach(elem => {
                    elem.textContent = data.like_count || 0;
                });
                
                // AllContents içinde ilgili içeriği güncelle
                const contentIndex = allContents.findIndex(c => c.id === parseInt(contentId));
                if (contentIndex !== -1) {
                    allContents[contentIndex].is_liked = data.liked;
                    allContents[contentIndex].like_count = data.like_count || 0;
                }
            }
        })
        .catch(error => console.error('Error:', error));
    }
    
    // Kaydetme işlevi
    function toggleSave(contentId, button) {
        fetch(`/profiles/content/${contentId}/toggle_save/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Tüm kartlarda ve modalda güncelleme yap
                updateSaveButtons(contentId, data.saved);
                
                // AllContents içinde ilgili içeriği güncelle
                const contentIndex = allContents.findIndex(c => c.id === parseInt(contentId));
                if (contentIndex !== -1) {
                    allContents[contentIndex].is_saved = data.saved;
                }
            }
        })
        .catch(error => console.error('Error:', error));
    }
    
    // Beğenme butonlarını güncelle
    function updateLikeButtons(contentId, isLiked) {
        // Kart üzerindeki beğenme butonunu güncelle
        const likeButtons = document.querySelectorAll(`.like-button[data-content-id="${contentId}"]`);
        likeButtons.forEach(btn => {
            const icon = btn.querySelector('i');
            btn.classList.toggle('liked', isLiked);
            
            if (isLiked) {
                icon.classList.remove('far');
                icon.classList.add('fas');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
            }
        });
        
        // Modal beğenme butonunu güncelle (eğer gösteriliyorsa)
        const modalLikeBtn = document.getElementById('modalLikeBtn');
        if (modalLikeBtn && modalLikeBtn.dataset.contentId === contentId) {
            const modalIcon = modalLikeBtn.querySelector('i');
            modalLikeBtn.classList.toggle('liked', isLiked);
            
            if (isLiked) {
                modalIcon.classList.remove('far');
                modalIcon.classList.add('fas');
                modalLikeBtn.innerHTML = `<i class="fas fa-heart"></i> Beğenildi`;
            } else {
                modalIcon.classList.remove('fas');
                modalIcon.classList.add('far');
                modalLikeBtn.innerHTML = `<i class="far fa-heart"></i> Beğen`;
            }
        }
    }
    
    // Kaydetme butonlarını güncelle
    function updateSaveButtons(contentId, isSaved) {
        // Kart üzerindeki kaydetme butonunu güncelle
        const saveButtons = document.querySelectorAll(`.save-button[data-content-id="${contentId}"]`);
        saveButtons.forEach(btn => {
            const icon = btn.querySelector('i');
            const text = btn.querySelector('.save-text');
            btn.classList.toggle('saved', isSaved);
            
            if (isSaved) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                if (text) text.textContent = 'Kaydedildi';
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                if (text) text.textContent = 'Kaydet';
            }
        });
        
        // Modal kaydetme butonunu güncelle (eğer gösteriliyorsa)
        const modalSaveBtn = document.getElementById('modalSaveBtn');
        if (modalSaveBtn && modalSaveBtn.dataset.contentId === contentId) {
            const modalIcon = modalSaveBtn.querySelector('i');
            modalSaveBtn.classList.toggle('saved', isSaved);
            
            if (isSaved) {
                modalIcon.classList.remove('far');
                modalIcon.classList.add('fas');
                modalSaveBtn.innerHTML = `<i class="fas fa-bookmark"></i> Kaydedildi`;
            } else {
                modalIcon.classList.remove('fas');
                modalIcon.classList.add('far');
                modalSaveBtn.innerHTML = `<i class="far fa-bookmark"></i> Kaydet`;
            }
        }
    }
    
    // Modal işlemleri
    const modal = document.getElementById('contentModal');
    const closeButton = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    const prevModalContent = document.getElementById('prevModalContent');
    const modalLikeBtn = document.getElementById('modalLikeBtn');
    const modalSaveBtn = document.getElementById('modalSaveBtn');
    let currentModalContentId = null;
    
    // İçerik modalını aç
    function openContentModal(contentId) {
        currentModalContentId = contentId;
        
        // İçeriği AJAX ile çek
        fetch(`/profiles/content/${contentId}/detail/`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('İçerik yüklenirken bir hata oluştu');
                }
                return response.json();
            })
            .then(data => {
                // Modal içeriğini doldur
                modalTitle.textContent = data.title;
                modalContent.innerHTML = data.content;
                
                // Beğenme/kaydetme butonlarını güncelle
                modalLikeBtn.dataset.contentId = contentId;
                modalSaveBtn.dataset.contentId = contentId;
                
                const modalIcon = modalLikeBtn.querySelector('i');
                modalLikeBtn.classList.toggle('liked', data.liked);
                
                if (data.liked) {
                    modalIcon.classList.remove('far');
                    modalIcon.classList.add('fas');
                    modalLikeBtn.innerHTML = `<i class="fas fa-heart"></i> Beğenildi`;
                } else {
                    modalIcon.classList.remove('fas');
                    modalIcon.classList.add('far');
                    modalLikeBtn.innerHTML = `<i class="far fa-heart"></i> Beğen`;
                }
                
                const saveIcon = modalSaveBtn.querySelector('i');
                modalSaveBtn.classList.toggle('saved', data.saved);
                
                if (data.saved) {
                    saveIcon.classList.remove('far');
                    saveIcon.classList.add('fas');
                    modalSaveBtn.innerHTML = `<i class="fas fa-bookmark"></i> Kaydedildi`;
                } else {
                    saveIcon.classList.remove('fas');
                    saveIcon.classList.add('far');
                    modalSaveBtn.innerHTML = `<i class="far fa-bookmark"></i> Kaydet`;
                }
                
                // Modal beğen butonuna olay ekle
                modalLikeBtn.onclick = function() {
                    toggleLike(contentId, this);
                };
                
                // Modal kaydet butonuna olay ekle
                modalSaveBtn.onclick = function() {
                    toggleSave(contentId, this);
                };
                
                // Modalı göster
                modal.classList.add('active');
                document.body.style.overflow = 'hidden'; // Arka planı kaydırmayı engelle
            })
            .catch(error => {
                console.error('Hata:', error);
                // Hata durumunda da modal açılsın, ancak hata mesajı gösterilsin
                modalTitle.textContent = "İçerik";
                modalContent.innerHTML = '<p>İçerik yüklenirken bir hata oluştu. Lütfen daha sonra tekrar deneyin.</p>';
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
    }
    
    // Modal kapatma olayı
    if (closeButton) {
        closeButton.addEventListener('click', function() {
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Arka plan kaydırmayı tekrar etkinleştir
        });
    }
    
    // Modal dışına tıklama ile kapatma
    if (modal) {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }
        });
    }
    
    // İçerik kartlarına tıklama olayları
    myContentCards.forEach((card) => {
        card.addEventListener('click', function(e) {
            if (!e.target.closest('.interaction-button')) {
                const contentId = this.getAttribute('data-content-id');
                openContentModal(contentId);
            }
        });
    });
    
    // Kendi mizacı içerik sayfalama noktalarını oluştur
    createMyPaginationDots();
    
    // AJAX ile tüm içerikleri al
    function fetchAllContents() {
        // AJAX isteği ile tüm içerikleri al
        fetch('/profiles/api/all_contents/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('İçerikler alınırken bir hata oluştu');
                }
                return response.json();
            })
            .then(data => {
                // Tüm içerikleri diziye aktar
                allContents = data.contents;
                
                // Filtreleme yap ve içerikleri göster
                filterContents();
            })
            .catch(error => {
                console.error('Hata:', error);
                // Hata durumunda boş bir dizi kullan
                allContents = [];
                filterContents();
            });
    }
    
    // Sayfa yüklendiğinde içerikleri al
    fetchAllContents();
    
    // Beğen butonlarına tıklama olayı ekle
    document.querySelectorAll('.like-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation(); // Kart tıklamasını engelle
            const contentId = this.getAttribute('data-content-id');
            toggleLike(contentId, this);
        });
    });
    
    // Kaydet butonlarına tıklama olayı ekle
    document.querySelectorAll('.save-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation(); // Kart tıklamasını engelle
            const contentId = this.getAttribute('data-content-id');
            toggleSave(contentId, this);
        });
    });
    
    // CSRF token'ı almak için yardımcı fonksiyon
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>
{% endblock %}